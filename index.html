<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CodeMaster Pro</title>

<!-- ‚ïê‚ïê‚ïê CRITICAL: v-cloak + base styles before Vue ‚ïê‚ïê‚ïê -->
<style>
[v-cloak] { display: none !important; }

/* ‚îÄ‚îÄ Loading screen ‚îÄ‚îÄ */
#loading-screen {
  position: fixed; inset: 0; z-index: 9999;
  background: #06090f;
  display: flex; flex-direction: column;
  align-items: center; justify-content: center; gap: 24px;
}
.ld-logo {
  font-family: 'Space Grotesk', monospace;
  font-size: 30px; font-weight: 900; letter-spacing: -0.03em;
  color: #fff;
}
.ld-logo span { color: #22d3ee; }
.ld-ring {
  width: 48px; height: 48px;
  border: 2px solid #1e2d3d;
  border-top-color: #22d3ee;
  border-radius: 50%;
  animation: spin .75s linear infinite;
}
.ld-msg {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px; color: #334155; letter-spacing: 0.1em;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ‚îÄ‚îÄ Reset ‚îÄ‚îÄ */
*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
html, body { height: 100%; background: #06090f; color: #cbd5e1; overflow: hidden; }
body { font-family: 'Space Grotesk', 'Segoe UI', sans-serif; }
button { font-family: inherit; }
textarea, input { font-family: 'JetBrains Mono', monospace; }

/* ‚îÄ‚îÄ Scrollbar ‚îÄ‚îÄ */
::-webkit-scrollbar { width: 3px; height: 3px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: #1e2d3d; border-radius: 2px; }
::-webkit-scrollbar-thumb:hover { background: #334155; }

/* ‚îÄ‚îÄ Grid bg ‚îÄ‚îÄ */
.grid-bg {
  background-image:
    linear-gradient(rgba(34,211,238,0.018) 1px, transparent 1px),
    linear-gradient(90deg, rgba(34,211,238,0.018) 1px, transparent 1px);
  background-size: 44px 44px;
}

/* ‚îÄ‚îÄ Scan lines ‚îÄ‚îÄ */
body::after {
  content: '';
  position: fixed; inset: 0; pointer-events: none; z-index: 9998;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px,
    rgba(0,0,0,0.018) 2px, rgba(0,0,0,0.018) 4px);
}

/* ‚îÄ‚îÄ Code editor ‚îÄ‚îÄ */
.code-editor {
  font-family: 'JetBrains Mono', monospace !important;
  font-size: 12.5px; line-height: 1.75; tab-size: 2;
  background: #080d14; color: #abb2bf;
  border: 1px solid #1e2d3d; border-radius: 10px;
  padding: 16px; resize: none; outline: none; width: 100%;
  transition: border-color .2s, box-shadow .2s;
}
.code-editor:focus {
  border-color: rgba(34,211,238,.3);
  box-shadow: 0 0 0 3px rgba(34,211,238,.06);
}

/* ‚îÄ‚îÄ Nav ‚îÄ‚îÄ */
.nav-item {
  width: 100%; display: flex; align-items: center; gap: 10px;
  padding: 9px 12px; border-radius: 8px;
  border: none; border-left: 2px solid transparent;
  background: transparent; cursor: pointer; text-align: left;
  transition: all .15s; color: #475569;
  font-family: 'Space Grotesk', sans-serif; font-size: 13px; font-weight: 500;
  margin-bottom: 2px;
}
.nav-item:hover { background: rgba(34,211,238,.05); color: #94a3b8; }
.nav-active {
  background: linear-gradient(90deg, rgba(34,211,238,.1), transparent) !important;
  border-left-color: #22d3ee !important;
  color: #22d3ee !important;
}

/* ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ */
.tab-btn {
  padding: 11px 16px; border: none; background: transparent; cursor: pointer;
  font-family: 'Space Grotesk', sans-serif; font-size: 13px; font-weight: 500;
  color: #475569; border-bottom: 2px solid transparent; transition: all .15s;
}
.tab-btn:hover { color: #94a3b8; }
.tab-active { border-bottom-color: #22d3ee !important; color: #22d3ee !important; }

/* ‚îÄ‚îÄ XP bar ‚îÄ‚îÄ */
.xp-fill { background: linear-gradient(90deg, #22d3ee, #34d399); box-shadow: 0 0 8px rgba(34,211,238,.35); }
.progress-fill { transition: width .7s cubic-bezier(.4,0,.2,1); }

/* ‚îÄ‚îÄ Badges ‚Äî FIX: no string manipulation, use data-level attr ‚îÄ‚îÄ */
.badge { border-radius: 6px; padding: 2px 8px; font-size: 10px;
         font-family: 'JetBrains Mono', monospace; font-weight: 600; }
.badge-py   { background: rgba(59,130,246,.12); color: #60a5fa; border: 1px solid rgba(59,130,246,.28); }
.badge-js   { background: rgba(251,191,36,.12); color: #fbbf24; border: 1px solid rgba(251,191,36,.28); }
.badge-java { background: rgba(239,68,68,.12);  color: #f87171; border: 1px solid rgba(239,68,68,.28); }
.badge-ini  { background: rgba(34,211,238,.1);  color: #22d3ee; border: 1px solid rgba(34,211,238,.25); }
.badge-int  { background: rgba(168,85,247,.1);  color: #a855f7; border: 1px solid rgba(168,85,247,.25); }
.badge-adv  { background: rgba(251,146,60,.1);  color: #fb923c; border: 1px solid rgba(251,146,60,.25); }

/* ‚îÄ‚îÄ Quiz ‚îÄ‚îÄ */
.quiz-opt {
  transition: all .15s; cursor: pointer;
  display: flex; align-items: center; gap: 14px;
  padding: 14px 18px; border: 1px solid #1e2d3d;
  border-radius: 12px; background: #0d1520;
}
.quiz-opt:hover:not(.answered) { background: rgba(34,211,238,.05); border-color: rgba(34,211,238,.3); }
.quiz-correct { background: rgba(52,211,153,.07) !important; border-color: rgba(52,211,153,.4) !important; }
.quiz-wrong   { background: rgba(248,113,113,.07) !important; border-color: rgba(248,113,113,.4) !important; }
.quiz-dim     { opacity: .35; }

/* ‚îÄ‚îÄ Chat ‚îÄ‚îÄ */
.chat-user { background: rgba(34,211,238,.07); border: 1px solid rgba(34,211,238,.15);
             border-radius: 14px 14px 4px 14px; }
.chat-ai   { background: rgba(168,85,247,.06); border: 1px solid rgba(168,85,247,.15);
             border-radius: 14px 14px 14px 4px; }
.chat-err  { background: rgba(248,113,113,.07); border: 1px solid rgba(248,113,113,.2);
             border-radius: 14px; }

/* ‚îÄ‚îÄ Glows ‚îÄ‚îÄ */
.glow-cyan  { text-shadow: 0 0 16px rgba(34,211,238,.5); }
.glow-green { text-shadow: 0 0 16px rgba(52,211,153,.5); }

/* ‚îÄ‚îÄ Animations ‚îÄ‚îÄ */
@keyframes fadeIn  { from { opacity:0 }              to { opacity:1 } }
@keyframes slideUp { from { opacity:0; transform:translateY(16px) } to { opacity:1; transform:translateY(0) } }
@keyframes pulse   { 0%,100% { opacity:1 } 50% { opacity:.35 } }
@keyframes lvlPop  { 0%,100% { transform:scale(1) } 50% { transform:scale(1.3) } }
.anim-fade { animation: fadeIn  .3s ease-out; }
.anim-up   { animation: slideUp .35s ease-out; }
.pulse-dot { animation: pulse 2s ease-in-out infinite; }

/* ‚îÄ‚îÄ Toast ‚îÄ‚îÄ */
.toast-wrap {
  position: fixed; bottom: 24px; right: 24px; z-index: 10000;
  display: flex; flex-direction: column; gap: 10px;
}
.toast {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 20px; border-radius: 12px;
  font-family: 'Space Grotesk', sans-serif; font-size: 13px; font-weight: 600;
  animation: slideUp .25s ease-out;
  backdrop-filter: blur(12px);
}
.toast-success { background: rgba(8,13,20,.95); border: 1px solid rgba(52,211,153,.4);
                 color: #34d399; box-shadow: 0 0 20px rgba(52,211,153,.12); }
.toast-error   { background: rgba(8,13,20,.95); border: 1px solid rgba(248,113,113,.4);
                 color: #f87171; box-shadow: 0 0 20px rgba(248,113,113,.12); }
.toast-info    { background: rgba(8,13,20,.95); border: 1px solid rgba(34,211,238,.35);
                 color: #22d3ee; }

/* ‚îÄ‚îÄ Error banner ‚îÄ‚îÄ */
.err-banner {
  background: rgba(248,113,113,.07); border: 1px solid rgba(248,113,113,.25);
  border-radius: 10px; padding: 12px 18px;
  font-family: 'JetBrains Mono', monospace; font-size: 12px; color: #f87171;
  display: flex; align-items: center; gap: 10px;
}

/* ‚îÄ‚îÄ Card ‚îÄ‚îÄ */
.card {
  background: #0d1520; border: 1px solid #1e2d3d; border-radius: 16px;
  transition: border-color .2s, transform .2s;
}
.card:hover { border-color: rgba(34,211,238,.2); }

/* ‚îÄ‚îÄ Hamburger ‚îÄ‚îÄ */
#hamburger-btn {
  display: none; align-items: center; justify-content: center;
  width: 36px; height: 36px; background: transparent;
  border: 1px solid #1e2d3d; border-radius: 8px;
  cursor: pointer; color: #64748b; font-size: 18px; flex-shrink: 0;
}

/* ‚îÄ‚îÄ Sidebar overlay (mobile) ‚îÄ‚îÄ */
#sidebar-overlay {
  display: none; position: fixed; inset: 0; z-index: 100;
  background: rgba(0,0,0,.65); backdrop-filter: blur(4px);
}

/* ‚îÄ‚îÄ Offline banner ‚îÄ‚îÄ */
.offline-banner {
  position: sticky; top: 0; z-index: 10;
  background: rgba(251,191,36,.1); border-bottom: 1px solid rgba(251,191,36,.25);
  padding: 8px 24px;
  font-family: 'JetBrains Mono', monospace; font-size: 11px; color: #fbbf24;
  display: flex; align-items: center; gap: 8px;
}

/* ‚îÄ‚îÄ hljs override ‚îÄ‚îÄ */
pre code.hljs { background: #080d14 !important; border-radius: 8px;
                padding: 18px !important; font-size: 12px !important; line-height: 1.7 !important; }

/* ‚ïê‚ïê MOBILE ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
@media (max-width: 768px) {
  html, body { overflow: hidden; }
  #hamburger-btn { display: flex; }
  #app { flex-direction: column !important; }
  #main-sidebar {
    position: fixed !important; left: -240px; top: 0; bottom: 0;
    width: 240px !important; z-index: 200;
    transition: left .28s cubic-bezier(.4,0,.2,1);
  }
  #main-sidebar.open { left: 0; }
  #sidebar-overlay.open { display: block; }
  #main-content { width: 100% !important; }
  #top-bar { padding: 0 14px !important; }
  #top-bar .top-stats { display: none; }
  .home-h1 { font-size: 30px !important; }
  .stats-grid { grid-template-columns: repeat(2,1fr) !important; }
  .grid-3 { grid-template-columns: 1fr !important; }
  #lessons-view { flex-direction: column !important; }
  #lesson-list { width: 100% !important; max-height: 190px;
                 border-right: none !important; border-bottom: 1px solid #1e2d3d; }
  #ex-list { width: 100% !important; max-height: 180px;
             border-right: none !important; border-bottom: 1px solid #1e2d3d; }
  #chat-input-row { padding: 10px 14px !important; }
  .quiz-pad { padding: 20px !important; }
}
@media (max-width: 480px) {
  .stats-grid { grid-template-columns: repeat(2,1fr) !important; }
  .grid-3 { grid-template-columns: 1fr !important; }
  .home-h1 { font-size: 24px !important; }
}
</style>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Space+Grotesk:wght@400;500;600;700;800&display=swap"
      rel="stylesheet" media="print" onload="this.media='all'">
</head>
<body class="grid-bg">

<!-- Loading -->
<div id="loading-screen">
  <div class="ld-logo">‚óà Code<span>Master</span> Pro</div>
  <div class="ld-ring"></div>
  <div class="ld-msg" id="load-msg">carregando...</div>
</div>

<!-- App root -->
<div id="app" v-cloak style="display:flex;height:100vh;overflow:hidden;">

  <!-- Mobile overlay -->
  <div id="sidebar-overlay" @click="closeSidebar()"></div>

  <!-- ‚îÄ‚îÄ‚îÄ SIDEBAR ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <aside id="main-sidebar"
    style="width:224px;background:#080d14;border-right:1px solid #1e2d3d;
           display:flex;flex-direction:column;flex-shrink:0;overflow:hidden;">

    <!-- top accent -->
    <div style="height:1px;background:linear-gradient(90deg,transparent,#22d3ee50,transparent);"></div>

    <!-- Logo -->
    <div style="padding:18px 20px 14px;border-bottom:1px solid #1e2d3d;">
      <div style="display:flex;align-items:center;gap:10px;">
        <span style="font-size:22px;color:#22d3ee;" class="glow-cyan">‚óà</span>
        <div>
          <div style="font-family:'Space Grotesk',sans-serif;font-weight:800;color:#f1f5f9;font-size:16px;letter-spacing:-.02em;">
            CodeMaster
          </div>
          <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#334155;letter-spacing:.05em;">Pro v3.0</div>
        </div>
      </div>
    </div>

    <!-- XP + Level -->
    <div style="padding:12px 16px;border-bottom:1px solid #1e2d3d;">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:7px;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#475569;letter-spacing:.08em;">
          N√çVEL {{ progress.level }}
        </span>
        <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#fbbf24;font-weight:700;">
          ‚ö° {{ progress.xp }} XP
        </span>
      </div>
      <div style="height:4px;background:#1e2d3d;border-radius:2px;overflow:hidden;">
        <div class="xp-fill progress-fill" style="height:100%;border-radius:2px;" :style="'width:'+xpPercent+'%'"></div>
      </div>
      <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#1e2d3d;margin-top:4px;">
        {{ xpToNext }} XP ‚Üí n√≠vel {{ progress.level + 1 }}
      </div>
    </div>

    <!-- Nav -->
    <nav style="flex:1;overflow-y:auto;padding:10px 0;">
      <div style="padding:0 10px;">
        <div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:#1e2d3d;
                    letter-spacing:.14em;padding:4px 10px 8px;text-transform:uppercase;">Navega√ß√£o</div>

        <button v-for="item in navItems" :key="item.id"
          class="nav-item" :class="currentView===item.id ? 'nav-active' : ''"
          @click="navigate(item.id)">
          <span style="font-size:16px;line-height:1;flex-shrink:0;">{{ item.icon }}</span>
          <span>{{ item.label }}</span>
        </button>

        <div style="font-family:'JetBrains Mono',monospace;font-size:8px;color:#1e2d3d;
                    letter-spacing:.14em;padding:14px 10px 8px;text-transform:uppercase;">Linguagens</div>

        <button v-for="lang in languages" :key="lang.id"
          class="nav-item"
          :class="currentView==='lessons' && currentLang===lang.id ? 'nav-active' : ''"
          @click="navigate('lessons', lang.id)">
          <span style="font-size:16px;line-height:1;flex-shrink:0;">{{ lang.emoji }}</span>
          <div style="flex:1;min-width:0;">
            <div style="font-size:13px;font-weight:600;color:#94a3b8;">{{ lang.name }}</div>
            <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#334155;">
              {{ langDone(lang.id) }}/{{ lang.lessons }} li√ß√µes
            </div>
          </div>
        </button>
      </div>
    </nav>

    <!-- AI status -->
    <div style="padding:8px 16px;border-top:1px solid #1e2d3d;display:flex;align-items:center;gap:8px;">
      <div class="pulse-dot" style="width:6px;height:6px;border-radius:50%;"
        :style="'background:'+(aiOnline?'#34d399':'#f87171')"></div>
      <span style="font-family:'JetBrains Mono',monospace;font-size:9px;"
        :style="'color:'+(aiOnline?'#34d39980':'#f8717180')">
        {{ aiOnline ? 'IA Online' : 'IA Offline' }}
      </span>
    </div>
    <div style="padding:6px 16px;border-top:1px solid #1e2d3d;text-align:center;
                font-family:'JetBrains Mono',monospace;font-size:8px;color:#1e2d3d;letter-spacing:.05em;">
      por <span style="color:#22d3ee;">Rik Thaylon</span>
    </div>
  </aside>

  <!-- ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <div id="main-content" style="flex:1;display:flex;flex-direction:column;overflow:hidden;">

    <!-- Top bar -->
    <header id="top-bar"
      style="height:48px;background:#080d14;border-bottom:1px solid #1e2d3d;
             display:flex;align-items:center;padding:0 24px;flex-shrink:0;gap:10px;">
      <button id="hamburger-btn" @click="toggleSidebar()" aria-label="Menu">‚ò∞</button>
      <span style="font-family:'Space Grotesk',sans-serif;font-weight:700;color:#f1f5f9;font-size:15px;">
        {{ pageTitle }}
      </span>
      <span v-if="pageCrumb" style="color:#1e2d3d;">/</span>
      <span v-if="pageCrumb"
        style="font-family:'JetBrains Mono',monospace;font-size:13px;color:#22d3ee;">{{ pageCrumb }}</span>
      <!-- Error indicator -->
      <div v-if="apiError" class="top-stats" style="margin-left:auto;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#f87171;">
          ‚ö† Erro de conex√£o
        </span>
      </div>
      <div v-else class="top-stats" style="margin-left:auto;display:flex;gap:16px;align-items:center;">
        <span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:#334155;">
          Li√ß√µes: <strong style="color:#34d399;">{{ progress.lessons?.length ?? 0 }}</strong>
          &nbsp;¬∑&nbsp;
          Exerc√≠cios: <strong style="color:#fbbf24;">{{ progress.exercises?.length ?? 0 }}</strong>
        </span>
      </div>
    </header>

    <!-- Views -->
    <div style="flex:1;overflow:hidden;">

      <!-- ‚ïê‚ïê HOME ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div v-if="currentView==='home'" style="height:100%;overflow-y:auto;padding:36px 40px;" class="anim-fade">
        <div style="max-width:920px;margin:0 auto;">

          <!-- Hero -->
          <div style="margin-bottom:40px;">
            <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:#22d3ee;
                        margin-bottom:10px;letter-spacing:.05em;">// bem-vindo de volta</div>
            <h1 class="home-h1" style="font-family:'Space Grotesk',sans-serif;font-weight:800;
                font-size:50px;color:#f1f5f9;line-height:1.05;margin-bottom:14px;letter-spacing:-.025em;">
              Aprenda a<br>
              <span style="background:linear-gradient(90deg,#22d3ee,#34d399);
                           -webkit-background-clip:text;-webkit-text-fill-color:transparent;">
                Programar
              </span>
            </h1>
            <p style="color:#475569;font-size:16px;max-width:480px;line-height:1.65;">
              Python, JavaScript e Java. Com IA integrada, exerc√≠cios pr√°ticos e quiz interativo.
            </p>
          </div>

          <!-- Error banner -->
          <div v-if="apiError" class="err-banner" style="margin-bottom:24px;">
            ‚ö†Ô∏è N√£o foi poss√≠vel conectar ao servidor. Verifique se o server.py est√° rodando.
          </div>

          <!-- Stats -->
          <div class="stats-grid" style="display:grid;grid-template-columns:repeat(4,1fr);gap:14px;margin-bottom:36px;">
            <div v-for="(s,i) in homeStats" :key="s.label"
              class="card anim-up" :style="'animation-delay:'+(i*.08)+'s;padding:20px;'">
              <div style="font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:36px;line-height:1;"
                :style="'color:'+s.color">{{ s.value }}</div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#475569;
                          margin-top:6px;text-transform:uppercase;letter-spacing:.1em;">{{ s.label }}</div>
            </div>
          </div>

          <!-- Language tracks -->
          <h2 style="font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:18px;
                     color:#f1f5f9;margin-bottom:16px;">üéØ Escolha sua trilha</h2>
          <div class="grid-3" style="display:grid;grid-template-columns:repeat(3,1fr);gap:16px;margin-bottom:24px;">
            <div v-for="lang in languages" :key="lang.id"
              class="card" @click="navigate('lessons', lang.id)"
              style="padding:26px;cursor:pointer;">
              <div style="font-size:42px;margin-bottom:14px;">{{ lang.emoji }}</div>
              <div style="font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:20px;
                          margin-bottom:6px;" :style="'color:'+lang.color">{{ lang.name }}</div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:#475569;margin-bottom:14px;">
                {{ lang.desc }}
              </div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#334155;margin-bottom:10px;">
                {{ lang.lessons }} li√ß√µes dispon√≠veis
              </div>
              <div style="height:3px;background:#1e2d3d;border-radius:2px;overflow:hidden;">
                <div class="progress-fill" style="height:100%;border-radius:2px;"
                  :style="'width:'+langPct(lang.id)+'%;background:'+lang.color"></div>
              </div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#475569;margin-top:6px;">
                {{ langPct(lang.id).toFixed(0) }}% conclu√≠do
              </div>
            </div>
          </div>

          <!-- Quick access -->
          <div class="grid-3" style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;">
            <button v-for="qa in quickAccess" :key="qa.id"
              class="card" @click="navigate(qa.id)"
              style="padding:20px;text-align:left;cursor:pointer;border:1px solid #1e2d3d;background:#0d1520;">
              <div style="font-size:26px;margin-bottom:8px;">{{ qa.icon }}</div>
              <div style="font-family:'Space Grotesk',sans-serif;font-weight:700;color:#f1f5f9;font-size:15px;">
                {{ qa.label }}
              </div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#475569;margin-top:4px;">
                {{ qa.sub }}
              </div>
            </button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê LI√á√ïES ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div v-else-if="currentView==='lessons'" id="lessons-view"
        style="height:100%;display:flex;overflow:hidden;" class="anim-fade">

        <!-- Lesson list -->
        <div id="lesson-list"
          style="width:252px;background:#080d14;border-right:1px solid #1e2d3d;
                 display:flex;flex-direction:column;flex-shrink:0;">
          <!-- Lang tabs -->
          <div style="display:flex;border-bottom:1px solid #1e2d3d;flex-shrink:0;">
            <button v-for="l in languages" :key="l.id"
              class="tab-btn" :class="l.id===currentLang?'tab-active':''"
              style="flex:1;padding:10px 4px;font-size:11px;font-weight:700;"
              @click="navigate('lessons', l.id)">
              {{ l.emoji }}<br>{{ l.name }}
            </button>
          </div>
          <!-- Items -->
          <div style="flex:1;overflow-y:auto;padding:6px 0;">
            <div v-if="lessonsLoading" style="padding:20px;text-align:center;">
              <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:#334155;">Carregando...</div>
            </div>
            <div v-else-if="lessonsError" style="padding:16px;">
              <div class="err-banner">Erro ao carregar li√ß√µes.</div>
            </div>
            <template v-else>
              <div v-for="(lesson,i) in lessons" :key="lesson.id"
                @click="selectLesson(lesson)"
                style="display:flex;align-items:flex-start;gap:10px;padding:10px 14px;
                       cursor:pointer;transition:all .12s;border-left:2px solid transparent;"
                :style="selectedLesson?.id===lesson.id ?
                  'background:#0f1929;border-left-color:#22d3ee' : ''">
                <div style="width:22px;height:22px;border-radius:50%;border:1px solid;
                            display:flex;align-items:center;justify-content:center;flex-shrink:0;
                            margin-top:1px;font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:700;"
                  :style="isDone(lesson.id) ?
                    'border-color:#34d39960;background:rgba(52,211,153,.1);color:#34d399' :
                    'border-color:#1e2d3d;color:#475569'">
                  {{ isDone(lesson.id) ? '‚úì' : i+1 }}
                </div>
                <div style="flex:1;min-width:0;">
                  <div style="font-family:'Space Grotesk',sans-serif;font-size:12.5px;font-weight:600;
                              white-space:nowrap;overflow:hidden;text-overflow:ellipsis;"
                    :style="selectedLesson?.id===lesson.id ? 'color:#f1f5f9' : 'color:#64748b'">
                    {{ lesson.emoji }} {{ lesson.title }}
                  </div>
                  <div style="display:flex;gap:6px;margin-top:3px;align-items:center;">
                    <span class="badge" :class="levelBadge(lesson.level)">{{ lesson.level }}</span>
                    <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#334155;">
                      {{ lesson.duration }}
                    </span>
                  </div>
                </div>
              </div>
            </template>
          </div>
        </div>

        <!-- Lesson detail -->
        <div style="flex:1;display:flex;flex-direction:column;overflow:hidden;">
          <div v-if="!selectedLesson" style="flex:1;display:flex;align-items:center;justify-content:center;">
            <div style="text-align:center;color:#1e2d3d;">
              <div style="font-size:60px;opacity:.15;margin-bottom:12px;">
                {{ languages.find(l=>l.id===currentLang)?.emoji }}
              </div>
              <div style="font-family:'Space Grotesk',sans-serif;font-size:18px;">Selecione uma li√ß√£o ‚Üí</div>
            </div>
          </div>

          <div v-else style="flex:1;display:flex;flex-direction:column;overflow:hidden;"
            class="anim-fade" :key="selectedLesson.id">
            <!-- Header -->
            <div style="padding:16px 28px;border-bottom:1px solid #1e2d3d;flex-shrink:0;
                        display:flex;align-items:flex-start;justify-content:space-between;gap:12px;">
              <div>
                <h2 style="font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:21px;color:#f1f5f9;">
                  {{ selectedLesson.emoji }} {{ selectedLesson.title }}
                </h2>
                <div style="display:flex;align-items:center;gap:10px;margin-top:6px;flex-wrap:wrap;">
                  <span class="badge" :class="levelBadge(selectedLesson.level)">{{ selectedLesson.level }}</span>
                  <span style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#475569;">
                    ‚è± {{ selectedLesson.duration }}
                  </span>
                  <span style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#fbbf24;">
                    +{{ selectedLesson.xp }} XP
                  </span>
                </div>
              </div>
              <button v-if="!isDone(selectedLesson.id)"
                @click="completeLesson(selectedLesson)"
                :disabled="lessonCompleting"
                style="flex-shrink:0;display:flex;align-items:center;gap:7px;
                       background:rgba(52,211,153,.07);border:1px solid rgba(52,211,153,.3);
                       color:#34d399;padding:9px 16px;border-radius:10px;cursor:pointer;
                       font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:13px;
                       transition:all .15s;white-space:nowrap;">
                {{ lessonCompleting ? '...' : '‚úì Concluir' }}
              </button>
              <div v-else style="flex-shrink:0;font-family:'Space Grotesk',sans-serif;font-weight:700;
                                 font-size:13px;color:#34d399;">
                ‚úÖ Conclu√≠da!
              </div>
            </div>

            <!-- Tabs -->
            <div style="display:flex;border-bottom:1px solid #1e2d3d;padding:0 28px;flex-shrink:0;">
              <button v-for="tab in lessonTabs" :key="tab.id"
                class="tab-btn" :class="activeTab===tab.id?'tab-active':''"
                @click="activeTab=tab.id">
                {{ tab.icon }} {{ tab.label }}
              </button>
            </div>

            <!-- Theory tab -->
            <div v-show="activeTab==='theory'" style="flex:1;overflow-y:auto;padding:28px;">
              <div style="max-width:700px;">
                <pre style="font-family:'JetBrains Mono',monospace;font-size:13px;color:#94a3b8;
                            white-space:pre-wrap;line-height:1.8;">{{ selectedLesson.theory }}</pre>
                <div v-if="selectedLesson.tip"
                  style="margin-top:22px;display:flex;align-items:flex-start;gap:12px;
                         background:rgba(251,191,36,.04);border:1px solid rgba(251,191,36,.18);
                         border-radius:12px;padding:14px 18px;">
                  <span style="font-size:18px;flex-shrink:0;">üí°</span>
                  <p style="font-family:'Space Grotesk',sans-serif;font-size:13px;
                            color:#94a3b8;line-height:1.65;">{{ selectedLesson.tip }}</p>
                </div>
              </div>
            </div>

            <!-- Code tab -->
            <div v-show="activeTab==='code'"
              style="flex:1;display:flex;flex-direction:column;padding:18px 28px;gap:12px;overflow:hidden;">
              <div style="display:flex;align-items:center;justify-content:space-between;flex-shrink:0;">
                <div style="display:flex;align-items:center;gap:8px;">
                  <div style="width:7px;height:7px;border-radius:50%;" :style="'background:'+langDotColor"></div>
                  <span style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#475569;">
                    editor.{{ langExt }}
                  </span>
                </div>
                <button @click="resetCode"
                  style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#475569;
                         background:#0d1520;border:1px solid #1e2d3d;padding:4px 12px;
                         border-radius:7px;cursor:pointer;transition:border-color .15s;">
                  ‚Ü∫ Reset
                </button>
              </div>
              <div style="flex:1;display:flex;gap:14px;min-height:0;">
                <textarea class="code-editor" style="flex:1;" v-model="editableCode" spellcheck="false"
                  :placeholder="'// Edite o c√≥digo aqui...'"
                  aria-label="Editor de c√≥digo"></textarea>
                <!-- Output preview -->
                <div style="width:240px;display:flex;flex-direction:column;flex-shrink:0;">
                  <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#334155;
                              text-transform:uppercase;letter-spacing:.1em;margin-bottom:6px;">
                    ‚ñº output (simulado)
                  </div>
                  <div style="flex:1;background:#050810;border:1px solid #1e2d3d;border-radius:8px;
                              padding:12px;font-family:'JetBrains Mono',monospace;font-size:11px;
                              color:#34d399;overflow-y:auto;line-height:1.75;">
                    <div v-if="outputLines.length===0" style="color:#1e2d3d;">// run no terminal</div>
                    <div v-for="(line,i) in outputLines" :key="i">
                      <span style="color:#1e2d3d;user-select:none;">{{ String(i+1).padStart(2,'0') }}‚îÇ</span>
                      {{ line }}
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê EXERC√çCIOS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div v-else-if="currentView==='exercises'"
        style="height:100%;display:flex;overflow:hidden;" class="anim-fade">

        <!-- Ex list -->
        <div id="ex-list"
          style="width:252px;background:#080d14;border-right:1px solid #1e2d3d;
                 display:flex;flex-direction:column;flex-shrink:0;">
          <!-- Filter -->
          <div style="display:flex;gap:4px;padding:10px;border-bottom:1px solid #1e2d3d;flex-shrink:0;">
            <button v-for="f in langFilters" :key="f.id"
              @click="exFilter=f.id"
              style="flex:1;padding:6px 4px;border:1px solid;border-radius:7px;cursor:pointer;
                     font-family:'JetBrains Mono',monospace;font-size:9px;font-weight:700;
                     transition:all .15s;font-size:10px;"
              :style="exFilter===f.id ?
                'border-color:rgba(34,211,238,.4);color:#22d3ee;background:rgba(34,211,238,.08)' :
                'border-color:#1e2d3d;color:#475569;background:transparent'">
              {{ f.label }}
            </button>
          </div>
          <!-- Items -->
          <div style="flex:1;overflow-y:auto;padding:6px 0;">
            <div v-for="ex in filteredExercises" :key="ex.id"
              @click="selectExercise(ex)"
              style="display:flex;align-items:flex-start;gap:10px;padding:10px 14px;
                     cursor:pointer;transition:all .12s;border-left:2px solid transparent;"
              :style="selectedEx?.id===ex.id ?
                'background:#0f1929;border-left-color:#22d3ee' : ''">
              <span style="font-size:20px;flex-shrink:0;">{{ ex.emoji }}</span>
              <div style="flex:1;min-width:0;">
                <div style="font-family:'Space Grotesk',sans-serif;font-size:12.5px;font-weight:600;
                            overflow:hidden;text-overflow:ellipsis;white-space:nowrap;"
                  :style="selectedEx?.id===ex.id ? 'color:#f1f5f9' : 'color:#64748b'">
                  {{ ex.title }}
                </div>
                <div style="display:flex;gap:6px;align-items:center;margin-top:3px;">
                  <span class="badge" :class="'badge-'+ex.lang">{{ ex.lang }}</span>
                  <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#fbbf24;">
                    +{{ ex.xp }} XP
                  </span>
                  <span v-if="isDoneEx(ex.id)" style="color:#34d399;font-size:11px;">‚úì</span>
                </div>
              </div>
            </div>
            <div v-if="filteredExercises.length===0"
              style="padding:20px;text-align:center;font-family:'JetBrains Mono',monospace;
                     font-size:11px;color:#334155;">
              Nenhum exerc√≠cio encontrado
            </div>
          </div>
        </div>

        <!-- Ex detail -->
        <div style="flex:1;display:flex;flex-direction:column;overflow:hidden;">
          <div v-if="!selectedEx"
            style="flex:1;display:flex;align-items:center;justify-content:center;color:#1e2d3d;">
            <div style="text-align:center;">
              <div style="font-size:56px;opacity:.15;margin-bottom:12px;">üíª</div>
              <div style="font-family:'Space Grotesk',sans-serif;font-size:18px;">Selecione um exerc√≠cio ‚Üí</div>
            </div>
          </div>

          <div v-else style="flex:1;display:flex;flex-direction:column;overflow:hidden;"
            class="anim-fade" :key="selectedEx.id">
            <!-- Header -->
            <div style="padding:14px 24px;border-bottom:1px solid #1e2d3d;flex-shrink:0;
                        display:flex;align-items:flex-start;justify-content:space-between;gap:12px;flex-wrap:wrap;">
              <div>
                <h2 style="font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:19px;color:#f1f5f9;">
                  {{ selectedEx.emoji }} {{ selectedEx.title }}
                </h2>
                <div style="display:flex;gap:8px;margin-top:6px;align-items:center;flex-wrap:wrap;">
                  <span class="badge" :class="'badge-'+selectedEx.lang">{{ selectedEx.lang }}</span>
                  <span class="badge" :class="levelBadge(selectedEx.level)">{{ selectedEx.level }}</span>
                  <span style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#fbbf24;">
                    +{{ selectedEx.xp }} XP
                  </span>
                </div>
              </div>
              <div style="display:flex;gap:8px;flex-wrap:wrap;">
                <button @click="showHint=!showHint"
                  style="padding:8px 14px;border:1px solid rgba(251,191,36,.3);
                         background:rgba(251,191,36,.06);color:#fbbf24;border-radius:9px;
                         cursor:pointer;font-size:12px;font-weight:600;transition:all .15s;">
                  üí° Dica
                </button>
                <button @click="showSol=!showSol"
                  style="padding:8px 14px;border:1px solid #1e2d3d;background:transparent;
                         color:#64748b;border-radius:9px;cursor:pointer;font-size:12px;">
                  üëÅ Solu√ß√£o
                </button>
                <button v-if="!isDoneEx(selectedEx.id)"
                  @click="completeExercise(selectedEx)"
                  :disabled="exCompleting"
                  style="padding:8px 16px;border:1px solid rgba(52,211,153,.3);
                         background:rgba(52,211,153,.07);color:#34d399;border-radius:9px;
                         cursor:pointer;font-size:12px;font-weight:700;transition:all .15s;">
                  {{ exCompleting ? '...' : '‚úÖ Concluir' }}
                </button>
                <span v-else style="font-family:'Space Grotesk',sans-serif;font-size:13px;
                                    font-weight:700;color:#34d399;display:flex;align-items:center;">
                  ‚úÖ Conclu√≠do!
                </span>
              </div>
            </div>

            <!-- Body -->
            <div style="flex:1;display:flex;overflow:hidden;">
              <div style="flex:1;display:flex;flex-direction:column;padding:16px 24px;gap:12px;overflow:hidden;">
                <!-- Challenge desc -->
                <div style="background:#0d1520;border:1px solid #1e2d3d;border-radius:12px;
                            padding:14px;flex-shrink:0;">
                  <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#22d3ee;
                              text-transform:uppercase;letter-spacing:.1em;margin-bottom:8px;">
                    üìã Desafio
                  </div>
                  <pre style="font-family:'Space Grotesk',sans-serif;font-size:13px;color:#94a3b8;
                              white-space:pre-wrap;line-height:1.65;">{{ selectedEx.desc }}</pre>
                </div>

                <!-- Hint -->
                <div v-if="showHint"
                  style="background:rgba(251,191,36,.04);border:1px solid rgba(251,191,36,.18);
                         border-radius:10px;padding:12px 16px;flex-shrink:0;">
                  <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#fbbf24;">
                    üí° DICA:
                  </span>
                  <span style="font-family:'Space Grotesk',sans-serif;font-size:13px;color:#94a3b8;
                               margin-left:6px;">{{ selectedEx.hint }}</span>
                </div>

                <!-- Editor -->
                <div style="flex:1;display:flex;flex-direction:column;min-height:0;">
                  <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#334155;
                              margin-bottom:6px;display:flex;align-items:center;gap:8px;
                              text-transform:uppercase;letter-spacing:.08em;">
                    <div style="width:6px;height:6px;border-radius:50%;"
                      :style="'background:'+exDotColor(selectedEx.lang)"></div>
                    seu_codigo.{{ exLangExt(selectedEx.lang) }}
                  </div>
                  <textarea class="code-editor" style="flex:1;"
                    v-model="exCode" spellcheck="false"
                    :aria-label="'C√≥digo do exerc√≠cio ' + selectedEx.title"></textarea>
                </div>
              </div>

              <!-- Solution panel -->
              <div v-if="showSol"
                style="width:340px;border-left:1px solid #1e2d3d;display:flex;flex-direction:column;
                       flex-shrink:0;background:rgba(8,13,20,.7);">
                <div style="padding:10px 16px;border-bottom:1px solid #1e2d3d;
                            display:flex;align-items:center;justify-content:space-between;flex-shrink:0;">
                  <span style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#475569;
                               text-transform:uppercase;letter-spacing:.1em;">üëÅ Solu√ß√£o</span>
                  <button @click="showSol=false"
                    style="border:none;background:transparent;color:#475569;cursor:pointer;font-size:16px;">
                    ‚úï
                  </button>
                </div>
                <div style="flex:1;overflow-y:auto;padding:14px;">
                  <textarea class="code-editor" style="height:100%;min-height:280px;"
                    :value="selectedEx.solution" readonly></textarea>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê QUIZ ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div v-else-if="currentView==='quiz'"
        style="height:100%;overflow-y:auto;" class="anim-fade">
        <div class="quiz-pad" style="max-width:680px;margin:0 auto;padding:36px 24px;">

          <!-- Start screen -->
          <div v-if="quizState==='start'" style="text-align:center;" class="anim-up">
            <div style="font-size:68px;margin-bottom:16px;">üß†</div>
            <h2 style="font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:34px;
                       color:#f1f5f9;margin-bottom:10px;">Quiz Interativo</h2>
            <p style="color:#475569;font-size:15px;margin-bottom:28px;">
              Teste seus conhecimentos em Python, JavaScript e Java!
            </p>
            <div style="display:flex;justify-content:center;gap:10px;margin-bottom:28px;flex-wrap:wrap;">
              <button v-for="f in quizLangFilters" :key="f.id"
                @click="quizLang=f.id"
                style="padding:10px 20px;border-radius:12px;border:1px solid;cursor:pointer;
                       font-family:'Space Grotesk',sans-serif;font-size:13px;font-weight:600;
                       transition:all .15s;"
                :style="quizLang===f.id ?
                  'border-color:rgba(34,211,238,.5);color:#22d3ee;background:rgba(34,211,238,.08)' :
                  'border-color:#1e2d3d;color:#475569;background:transparent'">
                {{ f.emoji }} {{ f.label }}
              </button>
            </div>
            <div v-if="quizLoadError" class="err-banner" style="margin-bottom:16px;">
              Erro ao carregar perguntas. Tente novamente.
            </div>
            <button @click="startQuiz" :disabled="quizLoading"
              style="background:rgba(34,211,238,.08);border:1px solid rgba(34,211,238,.4);
                     color:#22d3ee;font-family:'Space Grotesk',sans-serif;font-weight:800;
                     font-size:17px;padding:16px 40px;border-radius:16px;cursor:pointer;
                     transition:all .15s;box-shadow:0 0 24px rgba(34,211,238,.12);">
              {{ quizLoading ? '...' : '‚ñ∂ Iniciar Quiz' }}
            </button>
          </div>

          <!-- Playing -->
          <div v-else-if="quizState==='playing'" class="anim-up" :key="quizCurrent">
            <!-- Progress bar -->
            <div style="margin-bottom:22px;">
              <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:7px;">
                <span style="font-family:'JetBrains Mono',monospace;font-size:11px;color:#475569;">
                  {{ quizCurrent+1 }} / {{ quizQuestions.length }}
                </span>
                <span style="font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;color:#34d399;">
                  {{ quizScore }}/{{ quizCurrent }} ‚úì
                </span>
              </div>
              <div style="height:5px;background:#1e2d3d;border-radius:3px;overflow:hidden;">
                <div class="progress-fill"
                  style="height:100%;background:linear-gradient(90deg,#22d3ee,#34d399);border-radius:3px;"
                  :style="'width:'+((quizCurrent/quizQuestions.length)*100)+'%'"></div>
              </div>
            </div>

            <!-- Meta -->
            <div style="display:flex;align-items:center;gap:10px;margin-bottom:16px;">
              <span class="badge" :class="'badge-'+quizQuestions[quizCurrent]?.lang">
                {{ quizQuestions[quizCurrent]?.lang }}
              </span>
              <span class="badge" :class="levelBadge(quizQuestions[quizCurrent]?.level)">
                {{ quizQuestions[quizCurrent]?.level }}
              </span>
            </div>

            <!-- Question -->
            <h3 style="font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:19px;
                       color:#f1f5f9;line-height:1.45;margin-bottom:18px;">
              {{ quizQuestions[quizCurrent]?.q }}
            </h3>

            <!-- Options ‚Äî FIX: reactive via computed -->
            <div style="display:flex;flex-direction:column;gap:10px;margin-bottom:16px;">
              <div v-for="(opt,i) in quizQuestions[quizCurrent]?.opts" :key="i"
                class="quiz-opt"
                :class="[quizAnswered ? 'answered' : '', getOptClass(i)]"
                @click="quizAnswer(i)"
                :style="quizAnswered ? 'cursor:default' : 'cursor:pointer'"
                role="button" :aria-disabled="quizAnswered">
                <div style="width:30px;height:30px;border-radius:8px;border:1px solid currentColor;
                            display:flex;align-items:center;justify-content:center;flex-shrink:0;
                            font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:700;">
                  {{ String.fromCharCode(65+i) }}
                </div>
                <span style="font-family:'Space Grotesk',sans-serif;font-size:14px;color:#94a3b8;">
                  {{ opt }}
                </span>
              </div>
            </div>

            <!-- Explanation -->
            <transition name="fade">
              <div v-if="quizAnswered && quizExplanation"
                style="border-radius:12px;padding:14px 18px;margin-bottom:14px;"
                :style="quizLastCorrect ?
                  'background:rgba(52,211,153,.06);border:1px solid rgba(52,211,153,.25)' :
                  'background:rgba(248,113,113,.06);border:1px solid rgba(248,113,113,.25)'">
                <strong style="display:block;margin-bottom:6px;"
                  :style="quizLastCorrect ? 'color:#34d399' : 'color:#f87171'">
                  {{ quizLastCorrect ? '‚úÖ Correto!' : '‚ùå Incorreto.' }}
                </strong>
                <span style="font-family:'Space Grotesk',sans-serif;font-size:13px;color:#94a3b8;line-height:1.6;">
                  {{ quizExplanation }}
                </span>
              </div>
            </transition>

            <button v-if="quizAnswered" @click="quizNext"
              style="width:100%;background:rgba(34,211,238,.07);border:1px solid rgba(34,211,238,.3);
                     color:#22d3ee;font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:15px;
                     padding:14px;border-radius:12px;cursor:pointer;transition:all .15s;">
              {{ quizCurrent+1 < quizQuestions.length ? 'Pr√≥xima ‚Üí' : 'Ver Resultado ‚Üí' }}
            </button>
          </div>

          <!-- Results -->
          <div v-else-if="quizState==='done'" style="text-align:center;" class="anim-up">
            <div style="font-size:76px;margin-bottom:12px;">{{ quizResultEmoji }}</div>
            <h2 style="font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:30px;
                       color:#f1f5f9;margin-bottom:6px;">{{ quizResultMsg }}</h2>
            <div style="font-family:'Space Grotesk',sans-serif;font-weight:900;font-size:52px;margin-bottom:6px;"
              :style="quizPct>=70?'color:#34d399':quizPct>=40?'color:#fbbf24':'color:#f87171'">
              {{ quizScore }}/{{ quizQuestions.length }}
            </div>
            <div style="font-family:'JetBrains Mono',monospace;color:#475569;margin-bottom:8px;">
              {{ quizPct }}% de acerto
            </div>
            <div style="font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:18px;
                        color:#fbbf24;margin-bottom:28px;">
              +{{ quizXpEarned }} XP ganhos!
            </div>
            <button @click="quizRestart"
              style="background:rgba(34,211,238,.08);border:1px solid rgba(34,211,238,.4);
                     color:#22d3ee;font-family:'Space Grotesk',sans-serif;font-weight:800;
                     font-size:15px;padding:14px 32px;border-radius:14px;cursor:pointer;">
              üîÑ Novo Quiz
            </button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê IA TUTOR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div v-else-if="currentView==='ai'"
        style="height:100%;display:flex;flex-direction:column;overflow:hidden;" class="anim-fade">
        <!-- Header -->
        <div style="padding:14px 28px;border-bottom:1px solid #1e2d3d;flex-shrink:0;
                    display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
          <div>
            <h2 style="font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:19px;color:#f1f5f9;">
              ü§ñ CodeMaster AI
            </h2>
            <p style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#334155;margin-top:2px;">
              Tutor inteligente ¬∑ Python ¬∑ JavaScript ¬∑ Java
            </p>
          </div>
          <div style="display:flex;align-items:center;gap:12px;">
            <div style="display:flex;align-items:center;gap:7px;">
              <div class="pulse-dot" style="width:6px;height:6px;border-radius:50%;"
                :style="'background:'+(aiOnline?'#34d399':'#f87171')"></div>
              <span style="font-family:'JetBrains Mono',monospace;font-size:10px;"
                :style="'color:'+(aiOnline?'#34d399':'#f87171')">
                {{ aiOnline ? 'Online' : 'Offline' }}
              </span>
            </div>
            <button @click="clearChat"
              style="font-family:'JetBrains Mono',monospace;font-size:10px;color:#475569;
                     background:#0d1520;border:1px solid #1e2d3d;padding:6px 12px;
                     border-radius:8px;cursor:pointer;">
              üóë Limpar
            </button>
          </div>
        </div>

        <!-- Quick prompts -->
        <div style="display:flex;gap:7px;padding:10px 20px;border-bottom:1px solid #1e2d3d;
                    overflow-x:auto;flex-shrink:0;">
          <button v-for="q in quickPrompts" :key="q"
            @click="sendMessage(q)" :disabled="chatLoading"
            style="flex-shrink:0;font-family:'JetBrains Mono',monospace;font-size:10px;
                   color:#475569;background:#0d1520;border:1px solid #1e2d3d;padding:6px 12px;
                   border-radius:8px;cursor:pointer;transition:all .15s;white-space:nowrap;">
            {{ q }}
          </button>
        </div>

        <!-- Messages -->
        <div ref="chatEl"
          style="flex:1;overflow-y:auto;padding:20px 28px;display:flex;flex-direction:column;gap:14px;">
          <div v-if="chatMessages.length===0"
            style="flex:1;display:flex;align-items:center;justify-content:center;">
            <div style="text-align:center;color:#1e2d3d;">
              <div style="font-size:60px;opacity:.18;margin-bottom:14px;">ü§ñ</div>
              <div style="font-family:'Space Grotesk',sans-serif;font-size:18px;color:#334155;">
                Ol√°! Sou o CodeMaster AI
              </div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:11px;color:#1e2d3d;margin-top:6px;">
                Pergunte sobre Python, JS ou Java!
              </div>
            </div>
          </div>

          <div v-for="msg in chatMessages" :key="msg.id"
            style="display:flex;gap:10px;max-width:100%;"
            :style="msg.role==='user' ? 'justify-content:flex-end' : 'justify-content:flex-start'">
            <div v-if="msg.role!=='user'"
              style="width:32px;height:32px;border-radius:10px;
                     background:rgba(168,85,247,.12);border:1px solid rgba(168,85,247,.22);
                     display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px;">
              ü§ñ
            </div>
            <div style="max-width:70%;">
              <div :class="msg.role==='user' ? 'chat-user' : msg.error ? 'chat-err' : 'chat-ai'"
                style="padding:11px 16px;">
                <pre style="font-family:'JetBrains Mono',monospace;font-size:12px;
                            white-space:pre-wrap;line-height:1.65;"
                  :style="msg.role==='user' ? 'color:#22d3ee' : 'color:#94a3b8'">{{ msg.content }}</pre>
              </div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#334155;margin-top:3px;"
                :style="msg.role==='user' ? 'text-align:right' : ''">{{ msg.time }}</div>
            </div>
            <div v-if="msg.role==='user'"
              style="width:32px;height:32px;border-radius:10px;
                     background:rgba(34,211,238,.1);border:1px solid rgba(34,211,238,.2);
                     display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px;">
              üë§
            </div>
          </div>

          <!-- Typing indicator -->
          <div v-if="chatLoading" style="display:flex;gap:10px;">
            <div style="width:32px;height:32px;border-radius:10px;
                        background:rgba(168,85,247,.12);border:1px solid rgba(168,85,247,.22);
                        display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px;">
              ü§ñ
            </div>
            <div class="chat-ai" style="padding:14px 18px;display:flex;align-items:center;gap:6px;">
              <div v-for="i in 3" :key="i" class="pulse-dot"
                style="width:7px;height:7px;border-radius:50%;background:#a855f7;"
                :style="'animation-delay:'+(i*.18)+'s'"></div>
            </div>
          </div>
        </div>

        <!-- Input -->
        <div id="chat-input-row"
          style="padding:14px 28px;border-top:1px solid #1e2d3d;flex-shrink:0;display:flex;gap:10px;">
          <input v-model="chatInput"
            @keydown.enter.prevent="sendCurrentMsg"
            :disabled="chatLoading"
            style="flex:1;background:#0d1520;border:1px solid #1e2d3d;border-radius:10px;
                   padding:12px 16px;font-family:'JetBrains Mono',monospace;font-size:13px;
                   color:#e2e8f0;outline:none;transition:border-color .15s,box-shadow .15s;"
            placeholder="Pergunte sobre Python, JS, Java... (Enter para enviar)"
            aria-label="Digite sua mensagem">
          <button @click="sendCurrentMsg"
            :disabled="chatLoading || !chatInput.trim()"
            style="background:rgba(168,85,247,.1);border:1px solid rgba(168,85,247,.38);
                   color:#a855f7;padding:12px 20px;border-radius:10px;cursor:pointer;
                   font-family:'Space Grotesk',sans-serif;font-weight:900;font-size:16px;
                   transition:all .15s;min-width:50px;"
            aria-label="Enviar mensagem">
            {{ chatLoading ? '‚Ä¶' : '‚û§' }}
          </button>
        </div>
      </div>

      <!-- ‚ïê‚ïê PROGRESSO ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div v-else-if="currentView==='progress'"
        style="height:100%;overflow-y:auto;padding:36px 40px;" class="anim-fade">
        <div style="max-width:920px;margin:0 auto;">
          <h2 style="font-family:'Space Grotesk',sans-serif;font-weight:800;font-size:34px;
                     color:#f1f5f9;margin-bottom:28px;letter-spacing:-.02em;">
            üìä Seu Progresso
          </h2>

          <!-- Stats grid -->
          <div class="stats-grid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:24px;">
            <div v-for="(s,i) in progressStats" :key="s.label"
              class="card anim-up"
              :style="'animation-delay:'+(i*.07)+'s;padding:22px;'">
              <div style="font-size:26px;margin-bottom:10px;">{{ s.emoji }}</div>
              <div style="font-family:'Space Grotesk',sans-serif;font-weight:900;font-size:34px;"
                :style="'color:'+s.color">{{ s.value }}</div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#475569;
                          margin-top:4px;text-transform:uppercase;letter-spacing:.1em;">
                {{ s.label }}
              </div>
            </div>
          </div>

          <!-- XP bar -->
          <div class="card" style="padding:22px;margin-bottom:22px;">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
              <span style="font-family:'Space Grotesk',sans-serif;font-weight:700;color:#f1f5f9;font-size:15px;">
                N√≠vel {{ progress.level }} ‚Üí {{ progress.level+1 }}
              </span>
              <span style="font-family:'JetBrains Mono',monospace;font-size:12px;color:#22d3ee;">
                {{ xpInLevel }}/500 XP
              </span>
            </div>
            <div style="height:10px;background:#1e2d3d;border-radius:5px;overflow:hidden;">
              <div class="xp-fill progress-fill" style="height:100%;border-radius:5px;"
                :style="'width:'+xpLevelPct+'%'"></div>
            </div>
          </div>

          <!-- Per language -->
          <div class="grid-3" style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:24px;">
            <div v-for="lang in languages" :key="lang.id" class="card" style="padding:18px;">
              <div style="display:flex;align-items:center;gap:12px;margin-bottom:14px;">
                <span style="font-size:26px;">{{ lang.emoji }}</span>
                <div>
                  <div style="font-family:'Space Grotesk',sans-serif;font-weight:700;color:#f1f5f9;font-size:15px;">
                    {{ lang.name }}
                  </div>
                  <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#475569;">
                    {{ langDone(lang.id) }}/{{ lang.lessons }} li√ß√µes
                  </div>
                </div>
              </div>
              <div style="height:5px;background:#1e2d3d;border-radius:3px;overflow:hidden;">
                <div class="progress-fill" style="height:100%;border-radius:3px;"
                  :style="'width:'+langPct(lang.id)+'%;background:'+lang.color"></div>
              </div>
              <div style="font-family:'JetBrains Mono',monospace;font-size:9px;color:#475569;margin-top:6px;">
                {{ langPct(lang.id).toFixed(0) }}% completo
              </div>
            </div>
          </div>

          <!-- Conquistas -->
          <div class="card" style="padding:22px;">
            <h3 style="font-family:'Space Grotesk',sans-serif;font-weight:700;font-size:18px;
                       color:#f1f5f9;margin-bottom:18px;">üèÖ Conquistas</h3>
            <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:12px;">
              <div v-for="ach in achievements" :key="ach.id"
                style="border-radius:12px;padding:14px;text-align:center;border:1px solid;"
                :style="ach.earned ?
                  'background:#0f1929;border-color:#1e2d3d' :
                  'background:#080d14;border-color:#0d1520;opacity:.35'">
                <div style="font-size:26px;margin-bottom:7px;">{{ ach.earned ? ach.emoji : 'üîí' }}</div>
                <div style="font-family:'Space Grotesk',sans-serif;font-size:11px;font-weight:700;"
                  :style="ach.earned ? 'color:#f1f5f9' : 'color:#334155'">{{ ach.name }}</div>
                <div style="font-family:'JetBrains Mono',monospace;font-size:9px;margin-top:4px;"
                  :style="ach.earned ? 'color:#fbbf24' : 'color:#1e2d3d'">
                  {{ ach.earned ? '+'+ach.xp+' XP' : ach.req }}
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

    </div><!-- /views -->
  </div><!-- /main -->

  <!-- ‚îÄ‚îÄ Toast container ‚îÄ‚îÄ -->
  <div class="toast-wrap" aria-live="polite">
    <div v-for="t in toasts" :key="t.id" class="toast" :class="'toast-'+t.type">
      {{ t.icon }} {{ t.message }}
    </div>
  </div>

</div><!-- /app -->

<!-- Vue.js -->
<script src="/lib/vue.min.js" onerror="window._vueFailed=true"></script>
<script>
if (window._vueFailed || typeof Vue === 'undefined') {
  document.write('<script src="https://unpkg.com/vue@3.4.21/dist/vue.global.prod.js"><\/script>');
}
</script>
<script src="/lib/hljs.min.js"></script>
<link rel="stylesheet" href="/lib/atom-dark.min.css">

<script>
const { createApp, ref, computed, onMounted, watch, nextTick } = Vue;

// ‚îÄ‚îÄ‚îÄ API client with error handling ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const API = {
  async get(path) {
    const r = await fetch('/api' + path);
    if (!r.ok) throw new Error(`HTTP ${r.status}`);
    return r.json();
  },
  async post(path, body) {
    const r = await fetch('/api' + path, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(body)
    });
    if (!r.ok) {
      const err = await r.json().catch(() => ({}));
      throw new Error(err.error || `HTTP ${r.status}`);
    }
    return r.json();
  }
};

// ‚îÄ‚îÄ‚îÄ Toast IDs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
let _toastId = 0;

// ‚îÄ‚îÄ‚îÄ App ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const app = createApp({
  setup() {

    // ‚îÄ‚îÄ global state ‚îÄ‚îÄ
    const currentView  = ref('home');
    const currentLang  = ref('python');
    const progress     = ref({ xp:0, level:1, lessons:[], exercises:[], quizzes_taken:0, quiz_correct:0 });
    const languages    = ref([]);
    const aiOnline     = ref(false);
    const apiError     = ref(false);
    const toasts       = ref([]);

    // ‚îÄ‚îÄ lessons ‚îÄ‚îÄ
    const lessons          = ref([]);
    const selectedLesson   = ref(null);
    const activeTab        = ref('theory');
    const editableCode     = ref('');
    const lessonsLoading   = ref(false);
    const lessonsError     = ref(false);
    const lessonCompleting = ref(false);
    const lessonTabs       = [
      { id:'theory', icon:'üìñ', label:'Teoria' },
      { id:'code',   icon:'üíª', label:'C√≥digo' }
    ];

    // ‚îÄ‚îÄ exercises ‚îÄ‚îÄ
    const exercises     = ref([]);
    const selectedEx    = ref(null);
    const exCode        = ref('');
    const exFilter      = ref('all');
    const showHint      = ref(false);
    const showSol       = ref(false);
    const exCompleting  = ref(false);

    // ‚îÄ‚îÄ quiz ‚îÄ‚îÄ
    const quizState        = ref('start');
    const quizQuestions    = ref([]);
    const quizIds          = ref([]);
    const quizCurrent      = ref(0);
    const quizScore        = ref(0);
    const quizAnswered     = ref(false);
    const quizLang         = ref('all');
    const quizExplanation  = ref('');
    const quizLastCorrect  = ref(false);
    // FIX #1: Use Map for reactive option classes
    const quizOptMap       = ref(new Map());
    const quizLoading      = ref(false);
    const quizLoadError    = ref(false);

    // ‚îÄ‚îÄ ai chat ‚îÄ‚îÄ
    const chatMessages = ref([]);
    const chatHistory  = ref([]);
    const chatInput    = ref('');
    const chatLoading  = ref(false);
    const chatEl       = ref(null);
    let   _msgId       = 0;

    // ‚îÄ‚îÄ nav config ‚îÄ‚îÄ
    const navItems = [
      { id:'home',      icon:'üè†', label:'In√≠cio' },
      { id:'exercises', icon:'üíª', label:'Exerc√≠cios' },
      { id:'quiz',      icon:'üß†', label:'Quiz' },
      { id:'ai',        icon:'ü§ñ', label:'IA Tutor' },
      { id:'progress',  icon:'üìä', label:'Progresso' },
    ];
    const langFilters = [
      { id:'all',        label:'Todos' },
      { id:'python',     label:'üêç Py' },
      { id:'javascript', label:'‚ö° JS' },
      { id:'java',       label:'‚òï Java' },
    ];
    const quizLangFilters = [
      { id:'all',        label:'Todas',      emoji:'üéØ' },
      { id:'python',     label:'Python',     emoji:'üêç' },
      { id:'javascript', label:'JavaScript', emoji:'‚ö°' },
      { id:'java',       label:'Java',       emoji:'‚òï' },
    ];
    const quickPrompts = [
      'O que √© Python?', 'Explique loops', 'O que s√£o fun√ß√µes?',
      'JS vs Python', 'O que √© OOP?', 'Como funciona recurs√£o?',
    ];
    const quickAccess = computed(() => [
      { id:'exercises', icon:'üíª', label:'Exerc√≠cios', sub: `${progress.value.exercises?.length ?? 0} conclu√≠dos` },
      { id:'quiz',      icon:'üß†', label:'Quiz',        sub: `${progress.value.quizzes_taken ?? 0} realizados` },
      { id:'ai',        icon:'ü§ñ', label:'IA Tutor',    sub: 'Pergunte qualquer coisa' },
    ]);

    // ‚îÄ‚îÄ computed ‚îÄ‚îÄ
    const xpPercent  = computed(() => (progress.value.xp % 500) / 5);
    const xpToNext   = computed(() => 500 - (progress.value.xp % 500));
    const xpInLevel  = computed(() => progress.value.xp % 500);
    const xpLevelPct = computed(() => xpInLevel.value / 5);

    const pageTitle = computed(() => {
      const m = { home:'In√≠cio', lessons:'Li√ß√µes', exercises:'Exerc√≠cios',
                  quiz:'Quiz', ai:'IA Tutor', progress:'Progresso' };
      return m[currentView.value] || '';
    });
    const pageCrumb = computed(() => {
      if (currentView.value === 'lessons')
        return languages.value.find(l => l.id === currentLang.value)?.name;
      return null;
    });

    const homeStats = computed(() => [
      { label:'XP Total',   value: progress.value.xp ?? 0,                   color:'#fbbf24' },
      { label:'N√≠vel',      value: progress.value.level ?? 1,                color:'#22d3ee' },
      { label:'Li√ß√µes',     value: progress.value.lessons?.length ?? 0,      color:'#3b82f6' },
      { label:'Exerc√≠cios', value: progress.value.exercises?.length ?? 0,    color:'#34d399' },
    ]);
    const progressStats = computed(() => [
      { emoji:'‚ö°', label:'XP Total',     value: progress.value.xp ?? 0,                color:'#fbbf24' },
      { emoji:'üèÜ', label:'N√≠vel',         value: progress.value.level ?? 1,            color:'#22d3ee' },
      { emoji:'üìñ', label:'Li√ß√µes',        value: progress.value.lessons?.length ?? 0,  color:'#3b82f6' },
      { emoji:'üíª', label:'Exerc√≠cios',    value: progress.value.exercises?.length ?? 0,color:'#34d399' },
      { emoji:'üß†', label:'Quizzes',       value: progress.value.quizzes_taken ?? 0,    color:'#a855f7' },
      { emoji:'üéØ', label:'Quiz Corretas', value: progress.value.quiz_correct ?? 0,     color:'#fb923c' },
    ]);

    const filteredExercises = computed(() =>
      exFilter.value === 'all'
        ? exercises.value
        : exercises.value.filter(e => e.lang === exFilter.value)
    );

    const langDotColor = computed(() =>
      ({ python:'#3b82f6', javascript:'#fbbf24', java:'#ef4444' }[currentLang.value] || '#22d3ee')
    );
    const langExt = computed(() =>
      ({ python:'py', javascript:'js', java:'java' }[currentLang.value] || 'txt')
    );

    const quizPct = computed(() =>
      quizQuestions.value.length
        ? Math.round((quizScore.value / quizQuestions.value.length) * 100)
        : 0
    );
    const quizXpEarned    = computed(() => quizScore.value * 20);
    const quizResultEmoji = computed(() => quizPct.value >= 80 ? 'üèÜ' : quizPct.value >= 60 ? 'üëç' : 'üìö');
    const quizResultMsg   = computed(() => quizPct.value >= 80 ? 'Excelente!' : quizPct.value >= 60 ? 'Muito bem!' : 'Continue estudando!');

    // FIX #2: getOptClass uses reactive Map correctly
    const getOptClass = (i) => quizOptMap.value.get(i) || '';

    const achievements = computed(() => {
      const p  = progress.value;
      const ls = p.lessons  || [];
      const ex = p.exercises || [];
      return [
        { id:1,  emoji:'üêç', name:'Pythonista',   req:'1¬™ li√ß√£o Py',   xp:25,  earned: ls.some(l => l.startsWith('py'))     },
        { id:2,  emoji:'‚ö°', name:'JS Dev',        req:'1¬™ li√ß√£o JS',   xp:25,  earned: ls.some(l => l.startsWith('js'))     },
        { id:3,  emoji:'‚òï', name:'Java Dev',      req:'1¬™ li√ß√£o Java', xp:25,  earned: ls.some(l => l.startsWith('java'))   },
        { id:4,  emoji:'üíª', name:'Exercitador',  req:'1 exerc√≠cio',   xp:50,  earned: ex.length >= 1                       },
        { id:5,  emoji:'üéØ', name:'1¬∫ Quiz',      req:'1 quiz',        xp:50,  earned: p.quizzes_taken >= 1                 },
        { id:6,  emoji:'üî•', name:'5 Li√ß√µes',     req:'5 li√ß√µes',      xp:100, earned: ls.length >= 5                      },
        { id:7,  emoji:'‚≠ê', name:'100 XP',        req:'100 XP',        xp:25,  earned: p.xp >= 100                         },
        { id:8,  emoji:'üíé', name:'500 XP',        req:'500 XP',        xp:50,  earned: p.xp >= 500                         },
        { id:9,  emoji:'üöÄ', name:'1000 XP',       req:'1000 XP',       xp:100, earned: p.xp >= 1000                        },
        { id:10, emoji:'üëë', name:'Mestre',        req:'N√≠vel 5',       xp:200, earned: p.level >= 5                        },
        { id:11, emoji:'üèÜ', name:'10 Li√ß√µes',     req:'10 li√ß√µes',     xp:200, earned: ls.length >= 10                     },
        { id:12, emoji:'üåü', name:'Dedicado',      req:'5 exerc√≠cios',  xp:150, earned: ex.length >= 5                      },
      ];
    });

    // ‚îÄ‚îÄ helpers ‚îÄ‚îÄ
    const isDone   = (id) => (progress.value.lessons   || []).includes(id);
    const isDoneEx = (id) => (progress.value.exercises || []).includes(id);

    // FIX #3: use full lang name prefix to avoid "js" vs "java" collision
    const langDone = (langId) => {
      const prefix = langId === 'javascript' ? 'js_' : langId === 'python' ? 'py_' : 'java_';
      return (progress.value.lessons || []).filter(id => id.startsWith(prefix)).length;
    };
    const langPct = (langId) => {
      const total = languages.value.find(l => l.id === langId)?.lessons || 1;
      return Math.min(100, (langDone(langId) / total) * 100);
    };

    const exDotColor = (lang) =>
      ({ python:'#3b82f6', javascript:'#fbbf24', java:'#ef4444' }[lang] || '#22d3ee');
    const exLangExt  = (lang) =>
      ({ python:'py', javascript:'js', java:'java' }[lang] || 'txt');

    // FIX #4: level badge without string manipulation
    const levelBadge = (level) => {
      if (!level) return 'badge-ini';
      const l = level.toLowerCase();
      if (l.includes('inici'))  return 'badge-ini';
      if (l.includes('interm')) return 'badge-int';
      if (l.includes('avan'))   return 'badge-adv';
      return 'badge-ini';
    };

    // FIX #5: outputLines ‚Äî safe, supports python only (no fake JS/Java)
    const outputLines = computed(() => {
      if (currentLang.value !== 'python') return [];
      const code  = editableCode.value;
      const re    = /print\(([^)]+)\)/g;
      const lines = [];
      let m;
      while ((m = re.exec(code)) !== null && lines.length < 20) {
        let c = m[1].trim()
          .replace(/^f?["'`]|["'`]$/g, '')
          .replace(/\\n/g, ' ')
          .substring(0, 70);
        lines.push('‚Üí ' + c);
      }
      return lines;
    });

    // ‚îÄ‚îÄ toast system ‚îÄ‚îÄ
    const addToast = (message, type = 'success', icon = null) => {
      const icons  = { success:'‚úÖ', error:'‚ö†Ô∏è', info:'‚ÑπÔ∏è' };
      const id     = ++_toastId;
      toasts.value.push({ id, message, type, icon: icon ?? icons[type] });
      setTimeout(() => {
        toasts.value = toasts.value.filter(t => t.id !== id);
      }, 3200);
    };

    // ‚îÄ‚îÄ sidebar ‚îÄ‚îÄ
    const toggleSidebar = () => {
      document.getElementById('main-sidebar').classList.toggle('open');
      document.getElementById('sidebar-overlay').classList.toggle('open');
    };
    const closeSidebar = () => {
      document.getElementById('main-sidebar').classList.remove('open');
      document.getElementById('sidebar-overlay').classList.remove('open');
    };

    // ‚îÄ‚îÄ navigation ‚îÄ‚îÄ
    const navigate = async (view, lang = null) => {
      currentView.value = view;
      if (lang) currentLang.value = lang;
      if (view === 'lessons') await loadLessons();
      closeSidebar();
    };

    // ‚îÄ‚îÄ lessons ‚îÄ‚îÄ
    const loadLessons = async () => {
      lessonsLoading.value = true;
      lessonsError.value   = false;
      try {
        const data = await API.get(`/lessons/${currentLang.value}`);
        lessons.value = data;
        // Keep selection or pick first
        const cur = data.find(l => l.id === selectedLesson.value?.id);
        if (!cur && data.length) selectLesson(data[0]);
      } catch {
        lessonsError.value = true;
      } finally {
        lessonsLoading.value = false;
      }
    };

    const selectLesson = (lesson) => {
      selectedLesson.value = lesson;
      editableCode.value   = lesson.code || '';
      activeTab.value      = 'theory';
    };

    const resetCode = () => {
      if (selectedLesson.value) editableCode.value = selectedLesson.value.code || '';
    };

    const completeLesson = async (lesson) => {
      if (lessonCompleting.value) return;
      lessonCompleting.value = true;
      try {
        await API.post('/progress', { action:'complete_lesson', lesson_id:lesson.id });
        await loadProgress();
        addToast(`+50 XP! "${lesson.title}" conclu√≠da!`);
      } catch (e) {
        addToast(e.message || 'Erro ao salvar progresso', 'error');
      } finally {
        lessonCompleting.value = false;
      }
    };

    // ‚îÄ‚îÄ exercises ‚îÄ‚îÄ
    const selectExercise = (ex) => {
      selectedEx.value = ex;
      exCode.value     = ex.starter || '';
      showHint.value   = false;
      showSol.value    = false;
    };

    const completeExercise = async (ex) => {
      if (exCompleting.value) return;
      exCompleting.value = true;
      try {
        await API.post('/progress', { action:'complete_exercise', exercise_id:ex.id });
        await loadProgress();
        addToast(`+100 XP! "${ex.title}" conclu√≠do! üí™`);
      } catch (e) {
        addToast(e.message || 'Erro ao salvar progresso', 'error');
      } finally {
        exCompleting.value = false;
      }
    };

    // ‚îÄ‚îÄ quiz ‚îÄ‚îÄ
    const startQuiz = async () => {
      quizLoading.value   = true;
      quizLoadError.value = false;
      try {
        const url  = quizLang.value !== 'all'
          ? `/quiz/random?lang=${quizLang.value}&count=8`
          : '/quiz/random?count=10';
        const data = await API.get(url);
        quizQuestions.value  = data.questions;
        quizIds.value        = data.ids;
        quizCurrent.value    = 0;
        quizScore.value      = 0;
        quizAnswered.value   = false;
        quizExplanation.value = '';
        quizOptMap.value     = new Map();
        quizState.value      = 'playing';
      } catch {
        quizLoadError.value = true;
      } finally {
        quizLoading.value = false;
      }
    };

    const quizAnswer = async (idx) => {
      if (quizAnswered.value) return;
      quizAnswered.value = true;
      const qid    = quizIds.value[quizCurrent.value];
      try {
        const result = await API.post('/quiz/check', { answers: { [qid]: idx } });
        const r      = result.results[0];
        quizLastCorrect.value  = r.correct;
        quizExplanation.value  = r.explanation;
        if (r.correct) quizScore.value++;

        // FIX: replace entire Map to trigger Vue reactivity
        const newMap = new Map();
        const opts   = quizQuestions.value[quizCurrent.value]?.opts || [];
        opts.forEach((_, i) => {
          if (i === r.right_answer)         newMap.set(i, 'quiz-correct');
          else if (i === idx && !r.correct) newMap.set(i, 'quiz-wrong');
          else                              newMap.set(i, 'quiz-dim');
        });
        quizOptMap.value = newMap;
        await loadProgress();
      } catch {
        quizAnswered.value = false;
        addToast('Erro ao verificar resposta. Tente novamente.', 'error');
      }
    };

    const quizNext = () => {
      if (quizCurrent.value + 1 >= quizQuestions.value.length) {
        quizState.value = 'done';
      } else {
        quizCurrent.value++;
        quizAnswered.value    = false;
        quizExplanation.value = '';
        quizOptMap.value      = new Map();
      }
    };

    const quizRestart = () => { quizState.value = 'start'; };

    // ‚îÄ‚îÄ ai chat ‚îÄ‚îÄ
    const scrollChat = () => nextTick(() => {
      if (chatEl.value) chatEl.value.scrollTop = chatEl.value.scrollHeight;
    });
    const ftime = () =>
      new Date().toLocaleTimeString('pt-BR', { hour:'2-digit', minute:'2-digit' });

    const sendCurrentMsg = () => {
      const text = chatInput.value.trim();
      if (text && !chatLoading.value) {
        chatInput.value = '';
        sendMessage(text);
      }
    };

    const sendMessage = async (text) => {
      if (!text || chatLoading.value) return;
      chatMessages.value.push({ id:++_msgId, role:'user', content:text, time:ftime() });
      chatHistory.value.push({ role:'user', content:text });
      chatLoading.value = true;
      scrollChat();

      try {
        // FIX: limit history before sending
        const history = chatHistory.value.slice(-12);
        const result  = await API.post('/ai/chat', { messages: history });
        const content = result.response;
        chatHistory.value.push({ role:'assistant', content });
        chatMessages.value.push({ id:++_msgId, role:'assistant', content, time:ftime() });
      } catch {
        chatMessages.value.push({
          id: ++_msgId, role:'assistant', error: true,
          content: '‚ö†Ô∏è Erro de conex√£o. Verifique o servidor.', time: ftime()
        });
      } finally {
        chatLoading.value = false;
        scrollChat();
        // Keep history bounded
        if (chatHistory.value.length > 24)
          chatHistory.value = chatHistory.value.slice(-20);
      }
    };

    const clearChat = () => {
      chatMessages.value = [];
      chatHistory.value  = [];
    };

    // ‚îÄ‚îÄ data loaders ‚îÄ‚îÄ
    const loadProgress = async () => {
      try {
        progress.value = await API.get('/progress');
        apiError.value = false;
      } catch {
        apiError.value = true;
      }
    };

    const checkAI = async () => {
      try {
        const r = await API.get('/health');
        aiOnline.value = r.ai === true;
      } catch {
        aiOnline.value = false;
      }
    };

    // ‚îÄ‚îÄ mount ‚îÄ‚îÄ
    onMounted(async () => {
      try {
        const [langs, prog, exs] = await Promise.all([
          API.get('/languages'),
          API.get('/progress'),
          API.get('/exercises'),
        ]);
        languages.value  = langs;
        progress.value   = prog;
        exercises.value  = exs;
        apiError.value   = false;
        await loadLessons();
      } catch {
        apiError.value = true;
      }
      checkAI();

      // Hide loading screen
      const ls = document.getElementById('loading-screen');
      if (ls) { ls.style.opacity = '0'; ls.style.transition = 'opacity .4s'; setTimeout(() => ls.remove(), 400); }
    });

    // Watch language change
    watch(currentLang, () => {
      if (currentView.value === 'lessons') {
        selectedLesson.value = null;
        loadLessons();
      }
    });

    return {
      currentView, currentLang, progress, languages, aiOnline, apiError, toasts,
      navItems, langFilters, quizLangFilters, quickPrompts, quickAccess,
      xpPercent, xpToNext, xpInLevel, xpLevelPct,
      pageTitle, pageCrumb, homeStats, progressStats, achievements,
      // lessons
      lessons, selectedLesson, activeTab, editableCode, lessonTabs,
      lessonsLoading, lessonsError, lessonCompleting, outputLines,
      langDotColor, langExt, isDone, langDone, langPct, levelBadge,
      selectLesson, resetCode, completeLesson,
      // exercises
      exercises, selectedEx, exCode, exFilter, showHint, showSol,
      filteredExercises, exDotColor, exLangExt, isDoneEx, exCompleting,
      selectExercise, completeExercise,
      // quiz
      quizState, quizQuestions, quizCurrent, quizScore, quizAnswered, quizLang,
      quizExplanation, quizLastCorrect, quizPct, quizXpEarned, quizLoading, quizLoadError,
      quizResultEmoji, quizResultMsg, getOptClass,
      startQuiz, quizAnswer, quizNext, quizRestart,
      // chat
      chatMessages, chatInput, chatLoading, chatEl,
      sendCurrentMsg, sendMessage, clearChat,
      // nav
      navigate, loadProgress, toggleSidebar, closeSidebar,
    };
  }
});

app.mount('#app');
console.log('[CodeMaster Pro v3.0] ‚úÖ Ready');
</script>
</body>
</html>
